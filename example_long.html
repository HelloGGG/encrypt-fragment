<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>使用jsencrypt执行长文本分段加密，解密</title>
    </head>

    <body>
        <input type="button" id="btn" value="点我" />
        <div>密钥长度</div>
        <input id="key-size" type="text" placeholder="enter key size">
        <div>公钥</div>
        <textarea id="tra" rows="15" cols="65">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKjtJW+PjF4B9xPgAi0fchR38vxwoW8tJe473bRBo8Yhpz23akPo1hmLrC8syR9xhiLF6RFb601mY8uKxHC9KNsCAwEAAQ==</textarea>
        <div>私钥</div>
        <textarea id="sra" rows="15" cols="65">MIIBVgIBADANBgkqhkiG9w0BAQEFAASCAUAwggE8AgEAAkEAqO0lb4+MXgH3E+ACLR9yFHfy/HChby0l7jvdtEGjxiGnPbdqQ+jWGYusLyzJH3GGIsXpEVvrTWZjy4rEcL0o2wIDAQABAkBx01nmUlPDBI/4VHki7o1wPWL9tucQgtuMK8q4K4KvfeUPqx3gSN/VEtS9SZpz1/yyRQNe7EY2ybxLVJRHdlQBAiEA2y3sJbOSGjiYvV5nA5XDDkGg/2OnD6VBDkyHVqRF9RcCIQDFTgfZpUMRx8wa32/t/kI4v1843gh99TlxkjVVJjCM3QIhAMpLMFH70zVwV0kxAFNGvqlB2Z7eEytVkx3ndGJ7bDYxAiEAh6qC3VW0S1qNboDqjsPAtxJnoEuTnUBr8jqtb1ImGgUCIQCY+5Wuakxho/jpa0Jwy4APpUBSniE9koN9i4qFCJBtvA==</textarea>
    </body>
    <script src="./jquery.js"></script>
    <!--引入jsencrypt.js-->
    <script src="./bin/jsencrypt.js"></script>
    <script type="text/javascript">
        document.getElementById('btn').addEventListener('click', () => {
            let startTime = new Date();

            // 使用设置公私钥
            const enc = new JSEncrypt({
                default_key_size: Number(document.getElementById('key-size').value) || 1024
            });
            enc.setPublicKey(document.getElementById('tra').value);
            enc.setPrivateKey(document.getElementById('sra').value);

            // 一段长文本json
            let data = {
                code: 200,
                result: {
                    timestamp: 1572321851823,
                    interaction: [
                        {
                            type: 'shootYourBullet',
                            body: '{"actId":"241532192085135360","timestamp":1572321762049,"actTempId":"2","queIds":["10020"],"actTime":60,"online_trace_id":null}',
                            liveId: 100066318,
                            lecturerId: 'XN014604',
                            tutorId: 'XN014606',
                            parentType: 'interaction',
                            module: 'START',
                            command: 'START',
                            stuId: null,
                            online_trace_id: 'fhCb3oVqjM'
                        }
                    ],
                    upStream: {},
                    downStream: {},
                    liveStream: []
                }
            };
            let encrypted = enc.encryptLong(data);
            let endTime = new Date();
            console.log('加密后数据:%o', encrypted);
            console.log('加密时间' + (endTime - startTime) + 'ms');
            //使用私钥解密
            let uncrypted = enc.decryptLong(encrypted);
            console.log('解密后数据:%o', uncrypted);
        });
    </script>
</html>
